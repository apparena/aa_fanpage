<?php 
include_once ( '../init.php' );
?>
<h1>Database demo</h1>
<p>Our app template is using the <a href="http://framework.zend.com/manual/1.12/en/zend.db.adapter.html" target="_blank">Zend-Framework to connect to a database</a>. Here are some basic examples, how to perform queries on your database.</p>
<h2>Basic setup</h2>
<p>Just enter your database data in <strong>config.php</strong> and set $db_activated to 'true' to use it.</p>
<h2>Query demos</h2>
<h3><a href="http://framework.zend.com/manual/1.12/en/zend.db.adapter.html#zend.db.adapter.select.fetchall" target="_blank">Fetching a Complete Result Set</a></h3>
<pre>
$sql 	= "SELECT * FROM 'app_participant' WHERE 1";
$result = $db->fetchAll($sql);
</pre>

<h3>Fetching a Single Column from a Result Set</h3>
<pre>
$sql 	= "SELECT bug_description, bug_id FROM bugs WHERE bug_id = ?";
$result = $db->fetchCol($sql);
// contains bug_description; bug_id is not returned
echo $result[0];
</pre>

<h3>Fetching Key-Value Pairs from a Result Set</h3>
<pre>
$sql 	= "SELECT bug_id, bug_status FROM bugs";
$result = $db->fetchPairs($sql);
echo $result[2];
</pre>

<h3>Fetching a Single Row from a Result Set</h3>
<pre>
$sql 	= "SELECT * FROM bugs WHERE bug_id = 2";
$result = $db->fetchRow($sql);

// note that $result is a single object, not an array of objects
echo $result->bug_description;
</pre>

<h3>Fetching a Single Scalar from a Result Set</h3>
<pre>
$sql 	= "SELECT bug_status FROM bugs WHERE bug_id = 2";
$result = $db->fetchOne($sql);

// this is a single string value
echo $result;
</pre>
<h2>Write to DB demos</h2>
<h3><a href="http://framework.zend.com/manual/1.12/en/zend.db.adapter.html#zend.db.adapter.write.insert" target="_blank">Inserting data</a></h3>
<pre>
$data = array(
    'created_on'      => '2007-03-22',
    'bug_description' => 'Something wrong',
    'bug_status'      => 'NEW'
);
 
$db->insert('bugs', $data);

// return the last value generated by an auto-increment column
$id = $db->lastInsertId();
</pre>
<h3><a href="http://framework.zend.com/manual/1.12/en/zend.db.adapter.html#zend.db.adapter.write.update" target="_blank">Updating data</a></h3>
<pre>
$data = array(
    'updated_on'      => '2007-03-23',
    'bug_status'      => 'FIXED'
);
 
$where[] = "reported_by = 'goofy'";
$where[] = "bug_status = 'OPEN'";
 
$n = $db->update('bugs', $data, $where);
 
// Resulting SQL is:
//  UPDATE "bugs" SET "update_on" = '2007-03-23', "bug_status" = 'FIXED'
//  WHERE ("reported_by" = 'goofy') AND ("bug_status" = 'OPEN')
</pre>

<h3><a href="http://framework.zend.com/manual/1.12/en/zend.db.adapter.html#zend.db.adapter.write.delete" target="_blank">Deleting data</a></h3>
<pre>
$n = $db->delete('bugs', 'bug_id = 3');
</pre>